# Use the Percona PostgreSQL image with TDE as the base image
FROM perconalab/postgres-tde-ext

# Set environment variables
ENV POSTGRES_USER=tableye_admin
ENV POSTGRES_PASSWORD=123&&Tableye*
ENV POSTGRES_DB=tableye

# Install necessary packages and pgtle
USER root
RUN apt-get update && apt-get install -y \
    postgresql-server-dev-16 \
    build-essential \
    git \
    && rm -rf /var/lib/apt/lists/*

# Clone and install pgtle
RUN git clone https://github.com/percona/pgtle.git \
    && cd pgtle \
    && make && make install

# Switch back to postgres user
USER postgres

# Copy a custom initialization script
COPY init-user-db.sh /docker-entrypoint-initdb.d/

# Expose the PostgreSQL port
EXPOSE 5432

# The CMD instruction is inherited from the base image
